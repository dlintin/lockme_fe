{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/diantolintin/project/lockme/src/app/admin/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { GoogleLogin } from \"@react-oauth/google\";\nimport axios from \"axios\";\n\n// Helper to store token\nconst setToken = (token: string) => localStorage.setItem(\"lockme_token\", token);\nconst getToken = () => localStorage.getItem(\"lockme_token\");\n\nexport default function AdminPage() {\n    const [isAdmin, setIsAdmin] = useState(false);\n    const [stats, setStats] = useState<{ total_users: number; total_tribes: number; recent_users: any[] } | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(\"\");\n\n    const BACKEND_URL = \"http://127.0.0.1:8000\"; // Assuming local dev for now\n\n    useEffect(() => {\n        checkAdminStatus();\n    }, []);\n\n    const checkAdminStatus = async () => {\n        const token = getToken();\n        if (!token) {\n            setLoading(false);\n            return;\n        }\n\n        try {\n            // Try to fetch stats directly to verify token & admin status\n            const res = await axios.get(`${BACKEND_URL}/admin/stats`, {\n                headers: { Authorization: `Bearer ${token}` },\n            });\n            setStats(res.data);\n            setIsAdmin(true);\n        } catch (err) {\n            console.error(err);\n            // Token might be expired or user not admin\n            setError(\"Session expired or unauthorized.\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleLoginSuccess = async (credentialResponse: any) => {\n        if (!credentialResponse.credential) return;\n\n        try {\n            const res = await axios.post(`${BACKEND_URL}/auth/google`, {\n                id_token: credentialResponse.credential,\n            });\n\n            if (res.data.is_admin) {\n                setToken(res.data.access_token);\n                setIsAdmin(true);\n                // Fetch stats immediately\n                const statsRes = await axios.get(`${BACKEND_URL}/admin/stats`, {\n                    headers: { Authorization: `Bearer ${res.data.access_token}` },\n                });\n                setStats(statsRes.data);\n            } else {\n                alert(\"You are not an admin!\");\n            }\n        } catch (err) {\n            console.error(err);\n            alert(\"Login failed.\");\n        }\n    };\n\n    if (loading) return <div className=\"min-h-screen flex items-center justify-center bg-black text-white\">Loading...</div>;\n\n    if (!isAdmin) {\n        return (\n            <div className=\"min-h-screen flex flex-col items-center justify-center bg-black text-white p-4\">\n                <h1 className=\"text-3xl font-bold mb-8\">LockMe Admin</h1>\n                <div className=\"bg-gray-900 p-8 rounded-xl border border-gray-800\">\n                    <GoogleLogin\n                        onSuccess={handleLoginSuccess}\n                        onError={() => console.log('Login Failed')}\n                        theme=\"filled_black\"\n                        shape=\"pill\"\n                    />\n                </div>\n                {error && <p className=\"text-red-500 mt-4\">{error}</p>}\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-black text-white p-8 font-sans\">\n            <div className=\"max-w-4xl mx-auto\">\n                <div className=\"flex justify-between items-center mb-12\">\n                    <h1 className=\"text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent\">\n                        Admin Dashboard\n                    </h1>\n                    <button onClick={() => { localStorage.removeItem(\"lockme_token\"); window.location.reload(); }} className=\"text-sm text-gray-400 hover:text-white transition\">Sign Out</button>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mb-12\">\n                    <div className=\"p-8 rounded-2xl bg-gray-900/50 border border-gray-800 backdrop-blur-sm\">\n                        <h2 className=\"text-gray-400 text-sm uppercase tracking-wider mb-2\">Total Users</h2>\n                        <p className=\"text-6xl font-bold text-white\">{stats?.total_users || 0}</p>\n                    </div>\n\n                    <div className=\"p-8 rounded-2xl bg-gray-900/50 border border-gray-800 backdrop-blur-sm\">\n                        <h2 className=\"text-gray-400 text-sm uppercase tracking-wider mb-2\">Total Tribes</h2>\n                        <p className=\"text-6xl font-bold text-white\">{stats?.total_tribes || 0}</p>\n                    </div>\n                </div>\n\n                <div className=\"p-8 rounded-2xl bg-gray-900/50 border border-gray-800 backdrop-blur-sm\">\n                    <h2 className=\"text-2xl font-bold mb-6\">Recent Users</h2>\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-left\">\n                            <thead className=\"text-gray-400 border-b border-gray-800\">\n                                <tr>\n                                    <th className=\"pb-4 pl-4\">ID</th>\n                                    <th className=\"pb-4\">Email</th>\n                                    <th className=\"pb-4\">Name</th>\n                                    <th className=\"pb-4\">Provider</th>\n                                    <th className=\"pb-4\">Joined At</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-gray-800\">\n                                {stats?.recent_users?.map((u: any) => (\n                                    <tr key={u.id} className=\"hover:bg-white/5 transition\">\n                                        <td className=\"py-4 pl-4 text-gray-500\">#{u.id}</td>\n                                        <td className=\"py-4\">{u.email}</td>\n                                        <td className=\"py-4 font-medium\">{u.full_name || \"-\"}</td>\n                                        <td className=\"py-4 capitalize text-gray-400\">{u.provider}</td>\n                                        <td className=\"py-4 text-gray-400\">\n                                            {u.created_at ? new Date(u.created_at).toLocaleDateString() : \"-\"}\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}